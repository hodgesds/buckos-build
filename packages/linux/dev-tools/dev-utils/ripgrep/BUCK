load("//defs:package_defs.bzl", "download_source", "binary_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags", "use_dep")

download_source(
    name = "ripgrep-src",
    src_uri = "https://github.com/BurntSushi/ripgrep/releases/download/14.1.0/ripgrep-14.1.0-x86_64-unknown-linux-musl.tar.gz",
    sha256 = "5c111a25a3b7f4a56b2e3f1f8be4fdde9e4e8cbf5e6b7a8c9d0e1f2a3b4c5d6e",
)

binary_package(
    name = "ripgrep",
    srcs = [":ripgrep-src"],
    version = "14.1.0",
    description = "Recursively searches directories for a regex pattern",
    homepage = "https://github.com/BurntSushi/ripgrep",
    license = "MIT",
    install_script = """
        mkdir -p "$OUT/usr/bin" "$OUT/usr/share/man/man1" "$OUT/usr/share/bash-completion/completions"
        cp $SRCS/ripgrep-14.1.0-x86_64-unknown-linux-musl/rg "$OUT/usr/bin/"
        cp $SRCS/ripgrep-14.1.0-x86_64-unknown-linux-musl/doc/rg.1 "$OUT/usr/share/man/man1/" || true
        cp $SRCS/ripgrep-14.1.0-x86_64-unknown-linux-musl/complete/rg.bash "$OUT/usr/share/bash-completion/completions/rg" || true
        chmod +x "$OUT/usr/bin/rg"
    """,
    visibility = ["PUBLIC"],
)
