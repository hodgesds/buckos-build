load("//defs:package_defs.bzl", "download_source", "binary_package", "autotools_package")
load("//defs:use_flags.bzl", "set_use_flags", "use_dep")

download_source(
    name = "asciidoctor-src",
    src_uri = "https://github.com/asciidoctor/asciidoctor/archive/refs/tags/v2.0.23.tar.gz",
    sha256 = "72d271de1fccd3610e6f12bba29be1a3b6c8c813c5b2f3a12491ffc423090518",
)

binary_package(
    name = "asciidoctor",
    srcs = [":asciidoctor-src"],
    version = "2.0.23",
    description = "Converter for transforming AsciiDoc content to various formats",
    homepage = "https://asciidoctor.org/",
    license = "MIT",
    install_script = """
        cd $SRCS

        # gem should already be in PATH from Ruby dependency
        if ! command -v gem >/dev/null 2>&1; then
            echo "Error: Ruby gem command not found in PATH"
            echo "PATH=$PATH"
            exit 1
        fi

        export GEM_HOME="$OUT/usr/lib/ruby/gems"
        mkdir -p "$GEM_HOME"
        mkdir -p "$OUT/usr/bin"

        gem build asciidoctor.gemspec
        gem install --install-dir "$GEM_HOME" --bindir "$OUT/usr/bin" --no-document asciidoctor-*.gem
    """,
    deps = [
        "//packages/linux/lang/ruby:ruby",
    ],
    visibility = ["PUBLIC"],
)
