load("//defs:package_defs.bzl", "download_source", "autotools_package")
load("//defs:use_flags.bzl", "set_use_flags")

# giflib uses a simple Makefile (no configure script)
autotools_package(
    name = "giflib",
    version = "5.2.2",
    src_uri = "https://github.com/sailfishos-mirror/giflib/archive/refs/tags/5.2.2.tar.gz",
    sha256 = "d61f8ca6736d44a53888894858e085cf9266883c98dbbcd9ca0f222b13699190",
    signature_required = False,
    description = "Library for reading and writing GIF images",
    homepage = "https://giflib.sourceforge.net/",
    license = "MIT",
    src_configure = "true",
    src_compile = """
# Build library and utils, skip docs (requires xmlto)
make -j$(nproc) libgif.so libgif.a
make -j$(nproc) gif2rgb gifbuild gifclrmp giffix giftext giftool
""",
    src_install = """
# Install manually since Makefile install tries to build docs
install -d "$DESTDIR/usr/lib"
install -d "$DESTDIR/usr/include"
install -d "$DESTDIR/usr/bin"

install -m644 libgif.a "$DESTDIR/usr/lib/"
install -m755 libgif.so.* "$DESTDIR/usr/lib/"
ln -sf libgif.so.5 "$DESTDIR/usr/lib/libgif.so"
install -m644 gif_lib.h "$DESTDIR/usr/include/"
install -m755 gif2rgb gifbuild gifclrmp giffix giftext giftool "$DESTDIR/usr/bin/"
""",
    visibility = ["PUBLIC"],
)
