load("//defs:package_defs.bzl", "download_source", "autotools_package")
load("//defs:use_flags.bzl", "set_use_flags", "use_dep")

download_source(
    name = "libconfig-src",
    src_uri = "https://github.com/hyperrealm/libconfig/releases/download/v1.7.3/libconfig-1.7.3.tar.gz",
    sha256 = "545166d6cac037744381d1e9cc5a5405094e7bfad16a411699bcff40bbb31ee7",
    signature_required = False,
)

autotools_package(
    name = "libconfig",
    source = ":libconfig-src",
    version = "1.7.3",
    description = "C/C++ library for processing configuration files",
    homepage = "https://hyperrealm.github.io/libconfig/",
    license = "LGPL-2.1+",
    # Force regeneration of flex/bison files - the pre-generated files in the
    # tarball have incorrect extern declarations that don't match the reentrant
    # parser calls. Delete the .c/.h files to force make to regenerate them.
    src_prepare = """
cd lib
rm -f scanner.c scanner.h grammar.c grammar.h
cd ..
""",
    configure_args = [
        "--disable-static",
        "--disable-examples",
        "--disable-tests",
    ],
    deps = [
        "//packages/linux/dev-tools/dev-utils/flex:flex",
        "//packages/linux/dev-tools/dev-utils/bison:bison",
    ],
    visibility = ["PUBLIC"],
)
