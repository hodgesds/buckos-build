load("//defs:package_defs.bzl", "download_source", "meson_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags")

# mpv - A free, open source, and cross-platform media player

# USE flags for mpv (meson build):
# - X: X11 support (default: enabled)
# - wayland: Wayland support (default: enabled)
# - opengl: OpenGL support (default: enabled)
# - vulkan: Vulkan support (default: enabled)
# - vaapi: VA-API hardware acceleration (default: enabled)
# - vdpau: VDPAU hardware acceleration (default: enabled)
# - alsa: ALSA audio (default: enabled)
# - pulseaudio: PulseAudio audio (default: enabled)
# - pipewire: PipeWire audio (default: enabled)
# - jack: JACK audio (default: enabled)
# - lua: Lua scripting (default: enabled)

download_source(
    name = "mpv-src",
    src_uri = "https://github.com/mpv-player/mpv/archive/refs/tags/v0.38.0.tar.gz",
    sha256 = "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2",
)

meson_package(
    name = "mpv",
    srcs = [":mpv-src"],
    version = "0.38.0",
    description = "A free, open source, and cross-platform media player",
    homepage = "https://mpv.io/",
    license = "GPL-2.0-or-later LGPL-2.1-or-later",
    meson_args = [
        "-Dlibmpv=true",
        "-Dcplayer=true",
        "-Dbuild-date=false",
        "-Dtests=false",
        "-Dmanpage-build=disabled",
        "-Dhtml-build=disabled",
        "-Dpdf-build=disabled",
        "-Dlua=enabled",
        "-Djavascript=enabled",
        "-Dlibarchive=enabled",
        "-Dlibbluray=enabled",
        "-Ddvdnav=enabled",
        "-Dcdda=enabled",
        "-Drubberband=enabled",
        "-Dlcms2=enabled",
        "-Dvapoursynth=disabled",
        "-Dvulkan=enabled",
        "-Dshaderc=enabled",
        "-Dlibplacebo=enabled",
        "-Dgl=enabled",
        "-Degl=enabled",
        "-Degl-x11=enabled",
        "-Degl-wayland=enabled",
        "-Dgl-x11=enabled",
        "-Dwayland=enabled",
        "-Dx11=enabled",
        "-Ddrm=enabled",
        "-Dgbm=enabled",
        "-Dvaapi=enabled",
        "-Dvdpau=enabled",
        "-Dalsa=enabled",
        "-Djack=enabled",
        "-Dpulse=enabled",
        "-Dpipewire=enabled",
        "-Dsndio=enabled",
        "-Dsdl2=enabled",
    ],
    deps = [
        "//packages/linux/graphics/video/ffmpeg:ffmpeg",
        "//packages/linux/graphics/video/libva:libva",
        "//packages/linux/graphics/video/vdpau:vdpau",
        "//packages/linux/audio/daemons/alsa-lib:alsa-lib",
        "//packages/linux/audio/daemons/pulseaudio:pulseaudio",
        "//packages/linux/audio/daemons/pipewire:pipewire",
        "//packages/linux/desktop/libdrm:libdrm",
        "//packages/linux/lang/lua:lua",
        "//packages/linux/core/zlib:zlib",
    ],
    bdepend = [
        "//packages/linux/dev-tools/build-systems/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)
