# Heroic Games Launcher
# Open source GOG and Epic Games Launcher for Linux

load("//defs:package_defs.bzl", "binary_package", "download_source")

download_source(
    name = "heroic-src",
    src_uri = "https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher/releases/download/v2.15.2/heroic-2.15.2.tar.xz",
    sha256 = "1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3",
)

binary_package(
    name = "heroic",
    source = ":heroic-src",
    version = "2.15.2",
    description = "GOG and Epic Games Launcher for Linux",
    homepage = "https://heroicgameslauncher.com/",
    license = "GPL-3.0",
    install_script = """
#!/bin/bash
set -e

# Install Heroic to /opt
mkdir -p "$DESTDIR/opt/heroic"
tar -xJf heroic-*.tar.xz -C "$DESTDIR/opt/heroic" --strip-components=1

# Create symlink
mkdir -p "$DESTDIR/usr/bin"
ln -sf /opt/heroic/heroic "$DESTDIR/usr/bin/heroic"

# Install desktop entry
mkdir -p "$DESTDIR/usr/share/applications"
cat > "$DESTDIR/usr/share/applications/heroic.desktop" << 'EOF'
[Desktop Entry]
Name=Heroic Games Launcher
Comment=Open Source GOG and Epic Games Launcher
Exec=/opt/heroic/heroic %U
Icon=heroic
Terminal=false
Type=Application
Categories=Game;
MimeType=x-scheme-handler/heroic;
EOF

# Install icon
mkdir -p "$DESTDIR/usr/share/icons/hicolor/512x512/apps"
cp "$DESTDIR/opt/heroic/resources/app.asar.unpacked/build/icon.png" \
    "$DESTDIR/usr/share/icons/hicolor/512x512/apps/heroic.png" || true
    """,
    deps = [
        "//packages/linux/core/glibc:glibc",
    ],
    visibility = ["PUBLIC"],
)
