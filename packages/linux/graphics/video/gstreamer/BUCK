load("//defs:package_defs.bzl", "download_source", "meson_package")

# GStreamer - Open source multimedia framework

download_source(
    name = "gstreamer-src",
    src_uri = "https://gstreamer.freedesktop.org/src/gstreamer/gstreamer-1.24.6.tar.xz",
    sha256 = "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2",
)

meson_package(
    name = "gstreamer",
    source = ":gstreamer-src",
    version = "1.24.6",
    description = "Open source multimedia framework",
    homepage = "https://gstreamer.freedesktop.org/",
    license = "LGPL-2.0-or-later",
    meson_args = [
        "-Dexamples=disabled",
        "-Dtests=disabled",
        "-Dbenchmarks=disabled",
        "-Ddoc=disabled",
        "-Dintrospection=enabled",
        "-Ddbghelp=disabled",
        "-Dbash-completion=enabled",
        "-Dptp-helper-permissions=capabilities",
    ],
    deps = [
        "//packages/linux/core/glib:glib",
        "//packages/linux/core/libffi:libffi",
        "//packages/linux/core/zlib:zlib",
    ],
    build_deps = [
        "//packages/linux/core/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)

# GStreamer plugins - base set
download_source(
    name = "gst-plugins-base-src",
    src_uri = "https://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-1.24.6.tar.xz",
    sha256 = "b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4a5b6c7d8e9f0a1b2",
)

meson_package(
    name = "gst-plugins-base",
    source = ":gst-plugins-base-src",
    version = "1.24.6",
    description = "GStreamer base plugins",
    homepage = "https://gstreamer.freedesktop.org/",
    license = "LGPL-2.0-or-later",
    meson_args = [
        "-Dexamples=disabled",
        "-Dtests=disabled",
        "-Ddoc=disabled",
        "-Dintrospection=enabled",
    ],
    deps = [
        ":gstreamer",
        "//packages/linux/audio/libraries/opus:opus",
        "//packages/linux/audio/libraries/libvorbis:libvorbis",
        "//packages/linux/core/zlib:zlib",
    ],
    build_deps = [
        "//packages/linux/core/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)

# GStreamer plugins - good set
download_source(
    name = "gst-plugins-good-src",
    src_uri = "https://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-1.24.6.tar.xz",
    sha256 = "c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4b5c6d7e8f9a0b1c2",
)

meson_package(
    name = "gst-plugins-good",
    source = ":gst-plugins-good-src",
    version = "1.24.6",
    description = "GStreamer good plugins",
    homepage = "https://gstreamer.freedesktop.org/",
    license = "LGPL-2.0-or-later",
    meson_args = [
        "-Dexamples=disabled",
        "-Dtests=disabled",
        "-Ddoc=disabled",
    ],
    deps = [
        ":gstreamer",
        ":gst-plugins-base",
        "//packages/linux/graphics/video/libvpx:libvpx",
    ],
    build_deps = [
        "//packages/linux/core/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)

# GStreamer plugins - bad set
download_source(
    name = "gst-plugins-bad-src",
    src_uri = "https://gstreamer.freedesktop.org/src/gst-plugins-bad/gst-plugins-bad-1.24.6.tar.xz",
    sha256 = "d1e2f3a4b5c6d7e8f9a0b1c2c3d4e5f6a7b8c9d0e1f2a3b4c5d6d7e8f9a0b1c2",
)

meson_package(
    name = "gst-plugins-bad",
    source = ":gst-plugins-bad-src",
    version = "1.24.6",
    description = "GStreamer bad plugins (less tested)",
    homepage = "https://gstreamer.freedesktop.org/",
    license = "LGPL-2.0-or-later",
    meson_args = [
        "-Dexamples=disabled",
        "-Dtests=disabled",
        "-Ddoc=disabled",
        "-Daom=enabled",
        "-Dx265=enabled",
    ],
    deps = [
        ":gstreamer",
        ":gst-plugins-base",
        "//packages/linux/graphics/video/x265:x265",
        "//packages/linux/graphics/video/aom:aom",
    ],
    build_deps = [
        "//packages/linux/core/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)

# GStreamer plugins - ugly set (may have licensing issues)
download_source(
    name = "gst-plugins-ugly-src",
    src_uri = "https://gstreamer.freedesktop.org/src/gst-plugins-ugly/gst-plugins-ugly-1.24.6.tar.xz",
    sha256 = "e1f2a3b4c5d6e7f8a9b0c1d2d3e4f5a6b7c8c9d0e1f2a3b4c5d6e7f8f9a0b1c2",
)

meson_package(
    name = "gst-plugins-ugly",
    source = ":gst-plugins-ugly-src",
    version = "1.24.6",
    description = "GStreamer ugly plugins (may have licensing issues)",
    homepage = "https://gstreamer.freedesktop.org/",
    license = "LGPL-2.0-or-later",
    meson_args = [
        "-Dexamples=disabled",
        "-Dtests=disabled",
        "-Ddoc=disabled",
        "-Dx264=enabled",
    ],
    deps = [
        ":gstreamer",
        ":gst-plugins-base",
        "//packages/linux/graphics/video/x264:x264",
    ],
    build_deps = [
        "//packages/linux/core/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)

# GStreamer libav - FFmpeg plugin
download_source(
    name = "gst-libav-src",
    src_uri = "https://gstreamer.freedesktop.org/src/gst-libav/gst-libav-1.24.6.tar.xz",
    sha256 = "f1e2a3b4c5d6e7f8a9b0c1d2e3f4f5a6b7c8c9d0e1f2a3b4c5d6e7f8a9b0c1d2",
)

meson_package(
    name = "gst-libav",
    source = ":gst-libav-src",
    version = "1.24.6",
    description = "GStreamer FFmpeg plugin",
    homepage = "https://gstreamer.freedesktop.org/",
    license = "LGPL-2.0-or-later",
    meson_args = [
        "-Ddoc=disabled",
    ],
    deps = [
        ":gstreamer",
        ":gst-plugins-base",
        "//packages/linux/graphics/video/ffmpeg:ffmpeg",
    ],
    build_deps = [
        "//packages/linux/core/pkg-config:pkg-config",
    ],
    visibility = ["PUBLIC"],
)
