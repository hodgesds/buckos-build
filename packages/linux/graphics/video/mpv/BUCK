load("//defs:package_defs.bzl", "meson_package", "autotools_package")
load("//defs:use_flags.bzl", "set_use_flags")

# mpv - A free, open source, and cross-platform media player

# USE flags for mpv (meson build):
# - X: X11 support (default: enabled)
# - wayland: Wayland support (default: enabled)
# - opengl: OpenGL support (default: enabled)
# - vulkan: Vulkan support (default: enabled)
# - vaapi: VA-API hardware acceleration (default: enabled)
# - vdpau: VDPAU hardware acceleration (default: enabled)
# - alsa: ALSA audio (default: enabled)
# - pulseaudio: PulseAudio audio (default: enabled)
# - pipewire: PipeWire audio (default: enabled)
# - jack: JACK audio (default: enabled)
# - lua: Lua scripting (default: enabled)

meson_package(
    name = "mpv",
    version = "0.38.0",
    src_uri = "https://github.com/mpv-player/mpv/archive/refs/tags/v0.38.0.tar.gz",
    sha256 = "86d9ef40b6058732f67b46d0bbda24a074fae860b3eaae05bab3145041303066",
    signature_required = False,
    description = "A free, open source, and cross-platform media player",
    homepage = "https://mpv.io/",
    license = "GPL-2.0-or-later LGPL-2.1-or-later",
    meson_args = [
        "-Dlibmpv=true",
        "-Dcplayer=true",
        "-Dbuild-date=false",
        "-Dtests=false",
        "-Dmanpage-build=disabled",
        "-Dhtml-build=disabled",
        "-Dpdf-build=disabled",
        "-Dlua=enabled",
        "-Djavascript=enabled",
        "-Dlibarchive=enabled",
        "-Dlibbluray=enabled",
        "-Ddvdnav=enabled",
        "-Dcdda=enabled",
        "-Drubberband=enabled",
        "-Dlcms2=enabled",
        "-Dvapoursynth=disabled",
        "-Dvulkan=enabled",
        "-Dshaderc=enabled",
        "-Dlibplacebo=enabled",
        "-Dgl=enabled",
        "-Degl=enabled",
        "-Degl-x11=enabled",
        "-Degl-wayland=enabled",
        "-Dgl-x11=enabled",
        "-Dwayland=enabled",
        "-Dx11=enabled",
        "-Ddrm=enabled",
        "-Dgbm=enabled",
        "-Dvaapi=enabled",
        "-Dvdpau=disabled",  # Disabled: vdpau needs X11 libs
        "-Dalsa=enabled",
        "-Djack=enabled",
        "-Dpulse=enabled",
        "-Dpipewire=enabled",
        "-Dsndio=enabled",
        "-Dsdl2=enabled",
    ],
    deps = [
        "//packages/linux/graphics/video/ffmpeg:ffmpeg",
        "//packages/linux/graphics/video/libva:libva",
        # "//packages/linux/graphics/video/vdpau:vdpau",  # Disabled: needs X11 libs
        "//packages/linux/audio/daemons/alsa-lib:alsa-lib",
        "//packages/linux/audio/daemons/pulseaudio:pulseaudio",
        "//packages/linux/audio/daemons/pipewire:pipewire",
        "//packages/linux/desktop/libdrm:libdrm",
        "//packages/linux/lang/lua:lua",
        "//packages/linux/core/zlib:zlib",
    ],
    maintainers = [],
    visibility = ["PUBLIC"],
)
