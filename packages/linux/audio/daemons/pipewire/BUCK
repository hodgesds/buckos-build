load("//defs:package_defs.bzl", "download_source", "meson_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags")

# USE flags for pipewire (meson build):
# - alsa: ALSA support (default: enabled)
# - jack: JACK emulation (default: enabled)
# - pulseaudio: PulseAudio emulation (default: enabled)
# - bluetooth: Bluetooth/BlueZ5 support (default: disabled)
# - gstreamer: GStreamer plugin (default: disabled)
# - ffmpeg: FFmpeg integration (default: disabled)
# - vulkan: Vulkan support (default: disabled)
# - X: X11 support (default: disabled)
# - v4l: Video4Linux support (default: disabled)
# - doc: Documentation (default: disabled)
# - systemd: systemd integration (default: disabled)

meson_package(
    name = "pipewire",
    version = "1.0.7",
    src_uri = "https://gitlab.freedesktop.org/pipewire/pipewire/-/archive/1.0.7/pipewire-1.0.7.tar.gz",
    sha256 = "9c45eef65e66224804ae8671849452a7f221e913813072b3aad346f20df666a8",
    description = "Low-latency audio/video router and processor",
    homepage = "https://pipewire.org/",
    license = "MIT",
    meson_args = [
        "-Ddocs=disabled",
        "-Dexamples=disabled",
        "-Dman=disabled",
        "-Dtests=disabled",
        "-Dinstalled_tests=disabled",
        "-Dgstreamer=disabled",
        "-Dgstreamer-device-provider=disabled",
        "-Dsystemd=disabled",
        "-Dsystemd-system-service=disabled",
        "-Dsystemd-user-service=disabled",
        "-Dpipewire-alsa=enabled",
        "-Dpipewire-jack=enabled",
        "-Dpipewire-v4l2=disabled",
        "-Dspa-plugins=enabled",
        "-Dalsa=enabled",
        "-Daudiomixer=enabled",
        "-Daudioconvert=enabled",
        "-Dbluez5=disabled",
        "-Dbluez5-codec-aac=disabled",
        "-Dbluez5-codec-aptx=disabled",
        "-Dbluez5-codec-ldac=disabled",
        "-Dcontrol=enabled",
        "-Daudiotestsrc=enabled",
        "-Dffmpeg=disabled",
        "-Djack=enabled",
        "-Dsupport=enabled",
        "-Devl=disabled",
        "-Dtest=disabled",
        "-Dv4l2=disabled",
        "-Dlibcamera=disabled",
        "-Dvideoconvert=disabled",
        "-Dvideotestsrc=disabled",
        "-Dvolume=enabled",
        "-Dvulkan=disabled",
        "-Dpw-cat=enabled",
        "-Dudev=enabled",
        "-Dudevrulesdir=/lib/udev/rules.d",
        "-Dsdl2=disabled",
        "-Dsndfile=enabled",
        "-Dlibpulse=enabled",
        "-Droc=disabled",
        "-Davahi=disabled",
        "-Decho-cancel-webrtc=disabled",
        "-Dlibusb=disabled",
        "-Dsession-managers=[]",
        "-Draop=disabled",
        "-Dlv2=disabled",
        "-Dx11=disabled",
        "-Dx11-xfixes=disabled",
        "-Dlibcanberra=disabled",
        "-Dflatpak=disabled",
        "-Drlimits-install=false",
        "-Dsnap=false",
    ],
    deps = [
        "//packages/linux/audio/daemons/alsa-lib:alsa-lib",
        "//packages/linux/audio/libraries/libsndfile:libsndfile",
        "//packages/linux/system/libs/ipc/dbus:dbus",
    ],
    visibility = ["PUBLIC"],
)
