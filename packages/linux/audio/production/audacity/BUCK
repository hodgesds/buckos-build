load("//defs:package_defs.bzl", "download_source", "cmake_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags")

# USE flags for audacity (cmake build):
# - alsa: ALSA support (default: enabled)
# - jack: JACK support (default: disabled)
# - ffmpeg: FFmpeg support (default: disabled)
# - flac: FLAC support (default: enabled)
# - vorbis: Vorbis/OGG support (default: enabled)
# - mp3: MP3 support via lame/mad (default: enabled)
# - lv2: LV2 plugin support (default: disabled)
# - vst: VST plugin support (default: enabled)


cmake_package(
    name = "audacity",
    version = "3.5.1",
    src_uri = "https://github.com/audacity/audacity/archive/refs/tags/Audacity-3.5.1.tar.gz",
    sha256 = "71dd1e1a8d58f4345abb3664d2446d3ba09c95d9c81b9e2a58d1a818ba793a23",
    description = "Multi-track audio editor and recorder",
    homepage = "https://www.audacityteam.org/",
    license = "GPL-3",
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-Daudacity_conan_enabled=Off",
        "-Daudacity_has_networking=Off",
        "-Daudacity_has_updates_check=Off",
        "-Daudacity_has_crashreports=Off",
        "-Daudacity_has_sentry_reporting=Off",
        "-Daudacity_has_tests=Off",
        "-Daudacity_lib_preference=system",
        "-Daudacity_obey_system_dependencies=On",
        "-Daudacity_use_expat=system",
        "-Daudacity_use_ffmpeg=off",
        "-Daudacity_use_flac=system",
        "-Daudacity_use_id3tag=off",
        "-Daudacity_use_ladspa=on",
        "-Daudacity_use_lame=system",
        "-Daudacity_use_libmad=system",
        "-Daudacity_use_lv2=off",
        "-Daudacity_use_mad=system",
        "-Daudacity_use_midi=off",
        "-Daudacity_use_ogg=system",
        "-Daudacity_use_pa_alsa=on",
        "-Daudacity_use_pa_jack=off",
        "-Daudacity_use_pa_oss=off",
        "-Daudacity_use_portaudio=local",
        "-Daudacity_use_portmixer=local",
        "-Daudacity_use_sbsms=off",
        "-Daudacity_use_sndfile=system",
        "-Daudacity_use_soundtouch=off",
        "-Daudacity_use_soxr=off",
        "-Daudacity_use_sqlite=off",
        "-Daudacity_use_twolame=off",
        "-Daudacity_use_vamp=off",
        "-Daudacity_use_vorbis=system",
        "-Daudacity_use_vst=on",
        "-Daudacity_use_wxwidgets=system",
    ],
    deps = [
        "//packages/linux/audio/daemons/alsa-lib:alsa-lib",
        "//packages/linux/audio/libraries/libsndfile:libsndfile",
        "//packages/linux/audio/libraries/flac:flac",
        "//packages/linux/audio/libraries/libvorbis:libvorbis",
        "//packages/linux/audio/libraries/libogg:libogg",
        "//packages/linux/audio/libraries/lame:lame",
        "//packages/linux/audio/libraries/libmad:libmad",
        "//packages/linux/desktop/gnome:gtk3",
    ],
    visibility = ["PUBLIC"],
)
