load("//defs:package_defs.bzl", "download_source", "binary_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags", "use_dep")

# ladybird - Independent web browser built from scratch
#
# USE flags:
#   qt6      - Enable Qt6 GUI support
#   wayland  - Enable Wayland support
#   X        - Enable X11 support

download_source(
    name = "ladybird-src",
    src_uri = "https://github.com/LadybirdWebBrowser/ladybird/archive/refs/heads/master.tar.gz",
    sha256 = "e6306f9783189d98d87fdc3ba3e3d330efc19f559b2e0a19f8583b25a1381796",
)

binary_package(
    name = "ladybird",
    srcs = [":ladybird-src"],
    version = "0.1.0",
    description = "Ladybird - an independent web browser built from scratch",
    homepage = "https://ladybird.dev/",
    license = "BSD-2-Clause",
    install_script = """
        cd $SRCS/ladybird-*

        # Build with CMake
        cmake -S Meta/Lagom -B Build/lagom \\
            -GNinja \\
            -DCMAKE_BUILD_TYPE=Release \\
            -DCMAKE_INSTALL_PREFIX=/usr \\
            -DENABLE_QT=ON \\
            -DENABLE_LAGOM_LADYBIRD=ON

        ninja -C Build/lagom

        # Install
        DESTDIR="$OUT" ninja -C Build/lagom install
    """,
    deps = use_dep(
        {
            "zlib": ["//packages/linux/core/zlib:zlib"],
            # "qt6": ["//packages/linux/desktop/qt6-base:qt6-base"],
            "clang": ["//packages/linux/lang/clang:clang"],
            "curl": ["//packages/linux/network/curl:curl"],
        },
        ["zlib", "clang", "curl"],
    ),
    visibility = ["PUBLIC"],
)
