load("//defs:package_defs.bzl", "download_source", "autotools_package")
load("//defs:use_flags.bzl", "set_use_flags")

autotools_package(
    name = "freetype",
    version = "2.13.2",
    # Use official release tarball (not git archive) to avoid submodule issues
    src_uri = "https://download.savannah.gnu.org/releases/freetype/freetype-2.13.2.tar.xz",
    sha256 = "12991c4e55c506dd7f9b765933e62fd2be2e06d421505d7950a132e4f1bb484d",
    signature_required = False,
    description = "High-quality font rendering engine",
    homepage = "https://www.freetype.org/",
    license = "FTL GPL-2.0",
    iuse = ["static-libs", "bzip2", "png", "harfbuzz", "brotli", "zlib"],
    use_defaults = ["bzip2", "png", "brotli", "zlib"],
    use_configure = {
        "static-libs": "--enable-static",
        "-static-libs": "--disable-static",
        "bzip2": "--with-bzip2=yes",
        "-bzip2": "--with-bzip2=no",
        "png": "--with-png=yes",
        "-png": "--with-png=no",
        "harfbuzz": "--with-harfbuzz=yes",
        "-harfbuzz": "--with-harfbuzz=no",
        "brotli": "--with-brotli=yes",
        "-brotli": "--with-brotli=no",
        "zlib": "--with-zlib=yes",
        "-zlib": "--with-zlib=no",
    },
    use_deps = {
        "bzip2": ["//packages/linux/core/bzip2:bzip2"],
        "png": ["//packages/linux/system/libs/image/libpng:libpng"],
        "harfbuzz": ["//packages/linux/fonts/libraries/harfbuzz:harfbuzz"],
        "brotli": ["//packages/linux/system/libs/compression/brotli:brotli"],
        "zlib": ["//packages/linux/core/zlib:zlib"],
    },
    configure_args = [
        "--prefix=/usr",
        "--enable-freetype-config",
    ],
    deps = [],
    visibility = ["PUBLIC"],
)
