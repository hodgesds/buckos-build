load("//defs:package_defs.bzl", "download_source", "cmake_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags", "use_dep")

download_source(
    name = "rocksdb-src",
    src_uri = "https://github.com/facebook/rocksdb/archive/refs/tags/v9.1.1.tar.gz",
    sha256 = "54ca90dd0b0d8ccd8c24e3e8e2f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8",
)

cmake_package(
    name = "rocksdb",
    source = ":rocksdb-src",
    version = "9.1.1",
    description = "Persistent key-value store for fast storage environments",
    homepage = "https://rocksdb.org/",
    license = "GPL-2.0 OR Apache-2.0",
    cmake_args = [
        "-DWITH_TESTS=OFF",
        "-DWITH_BENCHMARK_TOOLS=OFF",
        "-DWITH_TOOLS=OFF",
        "-DWITH_GFLAGS=ON",
        "-DROCKSDB_BUILD_SHARED=ON",
        "-DFAIL_ON_WARNINGS=OFF",
    ],
    deps = [
        "//packages/linux/system/libs/compression/snappy",
        "//packages/linux/system/libs/compression/lz4",
        "//packages/linux/system/libs/compression/zstd",
        "//packages/linux/core/zlib",
        "//packages/linux/dev-libs/google/gflags",
    ],
    visibility = ["PUBLIC"],
)
