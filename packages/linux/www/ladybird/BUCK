load("//defs:package_defs.bzl", "download_source", "binary_package", "autotools_package")
load("//defs:use_flags.bzl", "set_use_flags", "use_dep")

# ladybird - Independent web browser built from scratch
#
# USE flags:
#   qt6      - Enable Qt6 GUI support
#   wayland  - Enable Wayland support
#   X        - Enable X11 support

# Note: Ladybird is actively developed and uses git master (no tagged releases yet)
# The checksum will need periodic updates as the master branch changes
download_source(
    name = "ladybird-src",
    src_uri = "https://github.com/LadybirdWebBrowser/ladybird/archive/refs/heads/master.tar.gz",
    sha256 = "4065a1d40c094235ef97fbfb132d87fb3b9e682f0c2bbf15a8d85024ba75b510",
)

binary_package(
    name = "ladybird",
    srcs = [":ladybird-src"],
    version = "0.1.0",
    description = "Ladybird - an independent web browser built from scratch",
    homepage = "https://ladybird.dev/",
    license = "BSD-2-Clause",
    install_script = """
        cd $SRCS

        # Build with CMake (use top-level CMakeLists.txt as per project docs)
        cmake -B Build \\
            -GNinja \\
            -DCMAKE_BUILD_TYPE=Release \\
            -DCMAKE_INSTALL_PREFIX=/usr \\
            -DENABLE_QT=ON

        ninja -C Build

        # Install
        DESTDIR="$OUT" ninja -C Build install
    """,
    deps = use_dep(
        {
            "zlib": ["//packages/linux/core/zlib:zlib"],
            # "qt6": ["//packages/linux/desktop/qt6-base:qt6-base"],
            "clang": ["//packages/linux/lang/clang:clang"],
            "curl": ["//packages/linux/network/curl:curl"],
        },
        ["zlib", "clang", "curl"],
    ),
    visibility = ["PUBLIC"],
)
