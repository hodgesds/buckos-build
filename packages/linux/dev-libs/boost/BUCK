load("//defs:package_defs.bzl", "download_source", "binary_package")
load("//defs:use_flags.bzl", "use_package", "set_use_flags", "use_dep")

# boost - Peer-reviewed C++ libraries
# USE flags: python, mpi, icu, zstd, bzip2, lzma, context, coroutine
# Default: icu, zstd, bzip2, lzma

download_source(
    name = "boost-src",
    src_uri = "https://boostorg.jfrog.io/artifactory/main/release/1.84.0/source/boost_1_84_0.tar.bz2",
    sha256 = "cc4b893acf645c9d4b698e9a0f08ca8846b5d35de9f86b6f93d1e3466b9d4ef4",
)

binary_package(
    name = "boost",
    srcs = [":boost-src"],
    version = "1.84.0",
    description = "Free peer-reviewed portable C++ source libraries",
    homepage = "https://www.boost.org/",
    license = "BSL-1.0",
    install_script = """
        cd boost_1_84_0
        ./bootstrap.sh --prefix=$PREFIX --with-toolset=gcc
        ./b2 install \
            --prefix=$PREFIX \
            --without-python \
            --without-mpi \
            variant=release \
            link=shared \
            threading=multi \
            runtime-link=shared \
            -j$(nproc)
    """,
    deps = [
        "//packages/linux/system/libs/compression/zstd:zstd",
        "//packages/linux/system/libs/compression/bzip2:bzip2",
        "//packages/linux/system/libs/compression/xz:xz",
        "//packages/linux/core/zlib:zlib",
        "//packages/linux/system/libs/utility/icu:icu",
    ],
    visibility = ["PUBLIC"],
)
