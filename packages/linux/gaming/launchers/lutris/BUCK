# Lutris - Open Gaming Platform
# Unified game launcher supporting multiple gaming platforms and emulators

load("//defs:package_defs.bzl", "configure_make_package", "download_source")
load("//defs:use_flags.bzl", "use_package", "set_use_flags")

download_source(
    name = "lutris-src",
    src_uri = "https://github.com/lutris/lutris/archive/refs/tags/v0.5.17.tar.gz",
    sha256 = "8a9c4d8e2b3c4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0",
)

# USE flags: See use_flags.bzl for available flags

configure_make_package(
    name = "lutris",
    source = ":lutris-src",
    version = "0.5.17",
    description = "Open Gaming Platform for Linux",
    homepage = "https://lutris.net/",
    license = "GPL-3.0",
    pre_configure = """
# Lutris uses Python/Meson, skip autoconf
mkdir -p build
    """,
    configure_args = [],
    env = {
        "PYTHON": "/usr/bin/python3",
    },
    post_install = """
#!/bin/bash
set -e

# Install Python package
cd "$SRC_DIR"
python3 setup.py install --root="$DESTDIR" --prefix=/usr --optimize=1

# Install desktop file
mkdir -p "$DESTDIR/usr/share/applications"
install -Dm644 share/applications/net.lutris.Lutris.desktop \
    "$DESTDIR/usr/share/applications/lutris.desktop"

# Install icons
mkdir -p "$DESTDIR/usr/share/icons/hicolor/scalable/apps"
install -Dm644 share/icons/hicolor/scalable/apps/lutris.svg \
    "$DESTDIR/usr/share/icons/hicolor/scalable/apps/lutris.svg"

# Install man page
mkdir -p "$DESTDIR/usr/share/man/man1"
install -Dm644 share/man/man1/lutris.1 \
    "$DESTDIR/usr/share/man/man1/lutris.1"
    """,
    deps = [
        "//packages/linux/lang/python:python",
        "//packages/linux/gaming/compatibility/wine:wine",
    ],
    visibility = ["PUBLIC"],
)
